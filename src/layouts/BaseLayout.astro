---
import { SEO } from "astro-seo";
import SkipLink from "../components/SkipLink.astro";
import ThemeToggle from "../components/ThemeToggle.tsx";
import "@fontsource-variable/geist";
import "../styles/global.css";

interface Props {
  title: string;
  description?: string;
  hideGlobalToggle?: boolean;
  canonicalUrl?: string;
  ogImage?: string;
  noindex?: boolean;
  nofollow?: boolean;
  languageAlternates?: Array<{ href: string; hrefLang: string }>;
}

const {
  title,
  description = "Matcha Pixels - anro.dev",
  hideGlobalToggle = false,
  canonicalUrl,
  ogImage,
  noindex = false,
  nofollow = false,
  languageAlternates = [
    { href: "https://anro.dev/", hrefLang: "en" },
    { href: "https://anro.dev/de/", hrefLang: "de" },
  ],
} = Astro.props;

const currentLocale = Astro.currentLocale ?? "en";
const resolvedCanonical =
  canonicalUrl ?? new URL(Astro.url.pathname, Astro.site).href;
---

<html lang={currentLocale} class="scroll-smooth">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content={Astro.generator} />

    <SEO
      title={title}
      titleTemplate="%s - anro.dev"
      titleDefault="anro.dev"
      description={description}
      canonical={resolvedCanonical}
      noindex={noindex}
      nofollow={nofollow}
      openGraph={{
        basic: {
          title: title,
          type: "website",
          image: ogImage ?? "https://anro.dev/og-default.jpg",
        },
        optional: {
          description: description,
          locale: currentLocale,
          siteName: "anro.dev",
        },
        image: ogImage
          ? {
              alt: title,
            }
          : undefined,
      }}
      twitter={{
        card: ogImage ? "summary_large_image" : "summary",
      }}
      languageAlternates={languageAlternates}
    />

    <slot name="head" />

    <!-- Theme init: prevents FOWT by setting data-theme before first paint.
         Keep in sync with ThemeToggle.tsx onMount (which syncs the Solid signal). -->
    <script is:inline>
      (function () {
        try {
          var stored = localStorage.getItem("theme");
          if (stored) {
            document.documentElement.setAttribute("data-theme", stored);
          } else if (
            window.matchMedia("(prefers-color-scheme: dark)").matches
          ) {
            document.documentElement.setAttribute("data-theme", "dark");
          }
        } catch (_) {}
      })();
    </script>
  </head>
  <body class="m-0 min-h-dvh">
    <SkipLink />
    {
      !hideGlobalToggle && (
        <div class="theme-toggle-wrapper">
          <ThemeToggle client:load />
        </div>
      )
    }
    <main id="main" role="main">
      <slot />
    </main>
  </body>
</html>

<style is:global>
  .theme-toggle-wrapper {
    position: fixed;
    top: 1rem;
    right: 1rem;
    z-index: 1000;
  }

  .theme-toggle {
    background: none;
    border: 2px solid currentColor;
    border-radius: 0.5rem;
    padding: 0.5rem;
    cursor: pointer;
    color: inherit;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: opacity 0.15s ease;
  }

  .theme-toggle:hover {
    opacity: 0.7;
  }
</style>
