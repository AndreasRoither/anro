{
	admin off
	auto_https off
}

:3000 {
	root * /srv
	encode gzip zstd

	# Health check endpoint (no file I/O)
	handle /health {
		respond "OK" 200
	}

	# Cache hashed Astro assets aggressively (fingerprinted filenames)
	@hashed path /_astro/*
	header @hashed Cache-Control "public, max-age=31536000, immutable"

	# Short cache for HTML pages
	@html path *.html
	header @html Cache-Control "public, max-age=3600"

	# Security headers
	header X-Content-Type-Options "nosniff"
	header X-Frame-Options "DENY"
	header Referrer-Policy "strict-origin-when-cross-origin"

	# Clean URLs: /projects â†’ /projects/index.html
	try_files {path} {path}/index.html {path}.html
	file_server

	handle_errors {
		@404de expression {err.status_code} == 404 && path('/de/*')
		handle @404de {
			rewrite * /de/404/index.html
			file_server
		}

		@404 expression {err.status_code} == 404
		handle @404 {
			rewrite * /404.html
			file_server
		}
	}
}
